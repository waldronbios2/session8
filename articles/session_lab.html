<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Session 8 lab exercise: What it's about • session8</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Session 8 lab exercise: What it's about">
<meta property="og:description" content="session8">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-176789980-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-176789980-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">session8</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lecture and Lab
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/session_lecture.html">Lecture notes</a>
    </li>
    <li>
      <a href="../articles/session_lecture.pdf">Lecture notes PDF</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/session_lab.html">Lab materials</a>
    </li>
  </ul>
</li>
<li class="dropdown-header">
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/waldronbios2/session8/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/leviwaldron1">
    <span class="fab fa fab fa-twitter fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="session_lab_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Session 8 lab exercise: What it’s about</h1>
                        <h4 class="author">Levi Waldron</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/waldronbios2/session8/blob/master/vignettes/session_lab.Rmd"><code>vignettes/session_lab.Rmd</code></a></small>
      <div class="hidden name"><code>session_lab.Rmd</code></div>

    </div>

    
    
<p><strong>Learning objectives</strong></p>
<ol style="list-style-type: decimal">
<li>Make stratified and unstratified Kaplan-Meier plots</li>
<li>Perform Cox proportional hazards regression</li>
<li>Assess proportional hazards assumption</li>
</ol>
<p><strong>Exercises</strong></p>
<div id="load-the-primary-biliary-cirrhosis-pbc-dataset-from-the-survival-package" class="section level1">
<h1 class="hasAnchor">
<a href="#load-the-primary-biliary-cirrhosis-pbc-dataset-from-the-survival-package" class="anchor"></a>Load the Primary Biliary Cirrhosis (pbc) dataset from the survival package</h1>
<ul>
<li>Mayo Clinic trial in primary biliary cirrhosis (PBC) of the liver conducted between 1974 and 1984, <span class="math inline">\(n=424\)</span> patients.</li>
<li>Randomized placebo controlled trial of the drug D-penicillamine.
<ul>
<li>312 cases from RCT, plus additional 112 not from RCT.</li>
</ul>
</li>
<li>Primary outcome is (censored) time to death</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival">survival</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">pbc</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pbc</span><span class="op">)</span></pre></div>
<pre><code>##        id             time          status            trt       
##  Min.   :  1.0   Min.   :  41   Min.   :0.0000   Min.   :1.000  
##  1st Qu.:105.2   1st Qu.:1093   1st Qu.:0.0000   1st Qu.:1.000  
##  Median :209.5   Median :1730   Median :0.0000   Median :1.000  
##  Mean   :209.5   Mean   :1918   Mean   :0.8301   Mean   :1.494  
##  3rd Qu.:313.8   3rd Qu.:2614   3rd Qu.:2.0000   3rd Qu.:2.000  
##  Max.   :418.0   Max.   :4795   Max.   :2.0000   Max.   :2.000  
##                                                  NA's   :106    
##       age        sex        ascites            hepato          spiders      
##  Min.   :26.28   m: 44   Min.   :0.00000   Min.   :0.0000   Min.   :0.0000  
##  1st Qu.:42.83   f:374   1st Qu.:0.00000   1st Qu.:0.0000   1st Qu.:0.0000  
##  Median :51.00           Median :0.00000   Median :1.0000   Median :0.0000  
##  Mean   :50.74           Mean   :0.07692   Mean   :0.5128   Mean   :0.2885  
##  3rd Qu.:58.24           3rd Qu.:0.00000   3rd Qu.:1.0000   3rd Qu.:1.0000  
##  Max.   :78.44           Max.   :1.00000   Max.   :1.0000   Max.   :1.0000  
##                          NA's   :106       NA's   :106      NA's   :106     
##      edema             bili             chol           albumin     
##  Min.   :0.0000   Min.   : 0.300   Min.   : 120.0   Min.   :1.960  
##  1st Qu.:0.0000   1st Qu.: 0.800   1st Qu.: 249.5   1st Qu.:3.243  
##  Median :0.0000   Median : 1.400   Median : 309.5   Median :3.530  
##  Mean   :0.1005   Mean   : 3.221   Mean   : 369.5   Mean   :3.497  
##  3rd Qu.:0.0000   3rd Qu.: 3.400   3rd Qu.: 400.0   3rd Qu.:3.770  
##  Max.   :1.0000   Max.   :28.000   Max.   :1775.0   Max.   :4.640  
##                                    NA's   :134                     
##      copper          alk.phos            ast              trig       
##  Min.   :  4.00   Min.   :  289.0   Min.   : 26.35   Min.   : 33.00  
##  1st Qu.: 41.25   1st Qu.:  871.5   1st Qu.: 80.60   1st Qu.: 84.25  
##  Median : 73.00   Median : 1259.0   Median :114.70   Median :108.00  
##  Mean   : 97.65   Mean   : 1982.7   Mean   :122.56   Mean   :124.70  
##  3rd Qu.:123.00   3rd Qu.: 1980.0   3rd Qu.:151.90   3rd Qu.:151.00  
##  Max.   :588.00   Max.   :13862.4   Max.   :457.25   Max.   :598.00  
##  NA's   :108      NA's   :106       NA's   :106      NA's   :136     
##     platelet        protime          stage      
##  Min.   : 62.0   Min.   : 9.00   Min.   :1.000  
##  1st Qu.:188.5   1st Qu.:10.00   1st Qu.:2.000  
##  Median :251.0   Median :10.60   Median :3.000  
##  Mean   :257.0   Mean   :10.73   Mean   :3.024  
##  3rd Qu.:318.0   3rd Qu.:11.10   3rd Qu.:4.000  
##  Max.   :721.0   Max.   :18.00   Max.   :4.000  
##  NA's   :11      NA's   :2       NA's   :6</code></pre>
</div>
<div id="create-a-surv-object-using-variables-time-and-status-add-this-to-the-pbc-dataframe" class="section level1">
<h1 class="hasAnchor">
<a href="#create-a-surv-object-using-variables-time-and-status-add-this-to-the-pbc-dataframe" class="anchor"></a>Create a <code>Surv</code> object using variables “time” and “status”, add this to the pbc dataframe</h1>
<p>Here “1” are patients who received transplants, and are thus removed from risk of death, at least due to liver cirrhosis. Transplantation may thus be related to risk, and not qualify as uninformative censoring. It could actually be considered a “competing hazard” because high-risk patients may be prioritized for liver transplant - a topic we don’t get to in this course. Instead, we will simply treat 0 (end of study) and 1 as censored, 2 (death) as an event.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">pbc2</span> <span class="op">&lt;-</span> <span class="va">pbc</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cens <span class="op">=</span> <span class="va">status</span> <span class="op">&gt;</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">cens</span><span class="op">)</span><span class="op">)</span></pre></div>
</div>
<div id="plot-a-km-curve-for-all-participants-using-librarysurvminer-function-ggsurvplot-" class="section level1">
<h1 class="hasAnchor">
<a href="#plot-a-km-curve-for-all-participants-using-librarysurvminer-function-ggsurvplot-" class="anchor"></a>Plot a KM curve for all participants using <code>library(survminer)</code> function <code>ggsurvplot()</code>.</h1>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.sthda.com/english/rpkgs/survminer/">survminer</a></span><span class="op">)</span></pre></div>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre><code>## Loading required package: ggpubr</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">pbc2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html">ggsurvplot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></pre></div>
<p><img src="session_lab_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div id="stratify-by-treatment-and-add-a-p-value-to-this-plot-see-ggsurvplot-" class="section level1">
<h1 class="hasAnchor">
<a href="#stratify-by-treatment-and-add-a-p-value-to-this-plot-see-ggsurvplot-" class="anchor"></a>Stratify by treatment and add a p-value to this plot (see <code>?ggsurvplot</code>).</h1>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">trt</span>, data <span class="op">=</span> <span class="va">pbc2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html">ggsurvplot</a></span><span class="op">(</span><span class="va">fit2</span>, pval <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></pre></div>
<p><img src="session_lab_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div id="check-whether-these-p-values-correspond-to-results-from-a-log-rank-test-" class="section level1">
<h1 class="hasAnchor">
<a href="#check-whether-these-p-values-correspond-to-results-from-a-log-rank-test-" class="anchor"></a>Check whether these p-values correspond to results from a log-rank test.</h1>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/survival/man/survdiff.html">survdiff</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">trt</span>, data <span class="op">=</span> <span class="va">pbc2</span><span class="op">)</span></pre></div>
<pre><code>## Call:
## survdiff(formula = y ~ trt, data = pbc2)
## 
## n=312, 106 observations deleted due to missingness.
## 
##         N Observed Expected (O-E)^2/E (O-E)^2/V
## trt=1 158       65     63.2    0.0502     0.102
## trt=2 154       60     61.8    0.0513     0.102
## 
##  Chisq= 0.1  on 1 degrees of freedom, p= 0.7</code></pre>
</div>
<div id="perform-a-cox-proportional-hazards-regression-using-the-trt-variable-as-a-predictor-" class="section level1">
<h1 class="hasAnchor">
<a href="#perform-a-cox-proportional-hazards-regression-using-the-trt-variable-as-a-predictor-" class="anchor"></a>Perform a Cox proportional hazards regression, using the “trt” variable as a predictor.</h1>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="va">fitcox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html">coxph</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">trt</span>, data <span class="op">=</span> <span class="va">pbc2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fitcox</span><span class="op">)</span></pre></div>
<pre><code>## Call:
## coxph(formula = y ~ trt, data = pbc2)
## 
##   n= 312, number of events= 125 
##    (106 observations deleted due to missingness)
## 
##         coef exp(coef) se(coef)      z Pr(&gt;|z|)
## trt -0.05722   0.94438  0.17916 -0.319    0.749
## 
##     exp(coef) exp(-coef) lower .95 upper .95
## trt    0.9444      1.059    0.6647     1.342
## 
## Concordance= 0.499  (se = 0.025 )
## Likelihood ratio test= 0.1  on 1 df,   p=0.7
## Wald test            = 0.1  on 1 df,   p=0.7
## Score (logrank) test = 0.1  on 1 df,   p=0.7</code></pre>
</div>
<div id="create-a-log-minus-log-plot-to-test-the-proportional-hazards-assumption-" class="section level1">
<h1 class="hasAnchor">
<a href="#create-a-log-minus-log-plot-to-test-the-proportional-hazards-assumption-" class="anchor"></a>Create a log-minus-log plot to test the proportional hazards assumption.</h1>
<p>Using a simpler method from survminer:</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.sthda.com/english/rpkgs/survminer/">survminer</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html">ggsurvplot</a></span><span class="op">(</span><span class="va">fit2</span>, fun <span class="op">=</span> <span class="st">"cloglog"</span><span class="op">)</span></pre></div>
<p><img src="session_lab_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div id="plot-schoenfeld-residuals-and-perform-schoenfeld-test-for-the-above-cox-model" class="section level1">
<h1 class="hasAnchor">
<a href="#plot-schoenfeld-residuals-and-perform-schoenfeld-test-for-the-above-cox-model" class="anchor"></a>Plot Schoenfeld residuals and perform Schoenfeld test for the above Cox model</h1>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="va">fitzph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/cox.zph.html">cox.zph</a></span><span class="op">(</span><span class="va">fitcox</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fitzph</span><span class="op">)</span></pre></div>
<p><img src="session_lab_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="va">fitzph</span></pre></div>
<pre><code>##        chisq df    p
## trt    0.612  1 0.43
## GLOBAL 0.612  1 0.43</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://waldronlab.io">Levi Waldron</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
